# ----------------------------------------------
# Build Stage
# ----------------------------------------------
FROM maven:3.8.6-openjdk-18-slim as build

# Changes working directory to /home/app (creates app subdir)
WORKDIR /home/app

# Copies all files from repo in one layer
COPY . .

# Packages a jar using the pom.xml config
RUN mvn clean package

# ----------------------------------------------
# Serve Stage
# ----------------------------------------------
FROM openjdk:18.0.2.1-slim-buster

# These three ports are needed for the application
## Jetty : 8180
## RMI   : 1099
## LDAP  : 1389
EXPOSE 1099 1389 8180

# Changes working directory to /home/app (creates app subdir)
WORKDIR /home/app

# Copies the packaged jar into the WORKDIR
COPY --from=build /home/app/target/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar /home/app/ldap-server.jar